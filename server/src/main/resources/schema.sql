DROP TABLE IF EXISTS PUBLIC.COMMENTS;
DROP TABLE IF EXISTS PUBLIC.BOOKINGS;
DROP TABLE IF EXISTS PUBLIC.ITEMS;
DROP TABLE IF EXISTS PUBLIC.REQUESTS;
DROP TABLE IF EXISTS PUBLIC.USERS;

CREATE TABLE IF NOT EXISTS USERS (
	USER_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	USER_NAME VARCHAR(255) NOT NULL,
	USER_EMAIL VARCHAR(254) UNIQUE NOT NULL,
	CONSTRAINT USERS_PK PRIMARY KEY (USER_ID)
);

CREATE TABLE IF NOT EXISTS REQUESTS (
	REQUEST_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	DESCRIPTION VARCHAR(3000) NOT NULL,
	USER_ID BIGINT NOT NULL,
	CREATED_TIME TIMESTAMP WITHOUT TIME ZONE NOT NULL,
	CONSTRAINT REQUEST_PK PRIMARY KEY (REQUEST_ID),
    CONSTRAINT REQUEST_USERS_FK FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS ITEMS (
	ITEM_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	ITEM_NAME VARCHAR(255) NOT NULL,
	DESCRIPTION VARCHAR NOT NULL,
	AVAILABLE BOOLEAN NOT NULL,
	USER_ID BIGINT NOT NULL,
	REQUEST_ID BIGINT,
	CONSTRAINT ITEMS_PK PRIMARY KEY (ITEM_ID),
	CONSTRAINT ITEMS_USERS_FK FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE,
	CONSTRAINT ITEMS_REQUESTS_FK FOREIGN KEY (REQUEST_ID) REFERENCES REQUESTS(REQUEST_ID)
);

CREATE TABLE IF NOT EXISTS BOOKINGS (
    BOOKING_ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    START_TIME TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    END_TIME TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    ITEM_ID BIGINT NOT NULL,
    USER_ID BIGINT NOT NULL,
    STATUS VARCHAR(8) NOT NULL,
    CONSTRAINT BOOKINGS_PK PRIMARY KEY (BOOKING_ID),
    CONSTRAINT BOOKINGS_ITEMS_FK FOREIGN KEY (ITEM_ID) REFERENCES ITEMS(ITEM_ID) ON DELETE CASCADE,
    CONSTRAINT BOOKINGS_USERS_FK FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS COMMENTS (
	COMMENT_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	TEXT VARCHAR(3000) NOT NULL,
	ITEM_ID BIGINT NOT NULL,
	USER_ID BIGINT NOT NULL,
	CREATED_TIME TIMESTAMP WITHOUT TIME ZONE NOT NULL,
	CONSTRAINT COMMENTS_PK PRIMARY KEY (COMMENT_ID),
	CONSTRAINT COMMENTS_ITEMS_FK FOREIGN KEY (ITEM_ID) REFERENCES ITEMS(ITEM_ID) ON DELETE CASCADE,
    CONSTRAINT COMMENTS_USERS_FK FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE
);


